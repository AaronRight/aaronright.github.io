<html>
	<head>
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" >
		<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
		<style>
			table input{
				width: 50px;
				height: 50px;
			}
			.input-group{	width: 200px;	}
			#game{			margin: 50px;	}
			h3{				margin: 0px;	}
			#timer{ 		margin: 5px;	}
		</style>
	</head>
	<body>
		<div id="game">
			<div class="input-group">
			  <input id="field-size" type="number" class="form-control" min="2" max="5" value="3">
			  <div class="input-group-append">
			    <input type="button" class="btn btn-dark" value="Generate" onclick="generate()"/>
			    <input id="manage-time" type="button" class="btn btn-outline-secondary" value="Start" onclick="start()"/>
			  </div>
			</div>
			<h3><span id="timer" class="badge badge-danger">0:00:000</span></h3>
			<div id="field"></div>
		</div>
	</body>
		<script type="text/javascript">
			var array;		var size;
			var empty_x;	var empty_y;
			var timer;		var timer_label = jQuery("#timer")[0];		var time_start;
				
			function btnClick(event){
				var target_x;
				var target_y;
				
				for (var i=0; i<size; i++)
					for (var j=0; j<size; j++)
						if ( event.target == array[i][j].firstChild ){
							target_x = i;
							target_y = j;
						}

				// move if neccessary
				if( (Math.abs (target_x - empty_x) == 1 && target_y == empty_y) 
				 || (Math.abs (target_y - empty_y) == 1 && target_x == empty_x) ){
					swap(target_x, target_y, empty_x, empty_y)
					empty_x = target_x;
					empty_y = target_y;
					// check if win
					if(isVictory())	stop();
					return;
				}
			}
			function generate(){
				var field = jQuery("#field")[0];
				size = jQuery("#field-size")[0].value;
				
				// clear field
				field.innerHTML = '';
				
				// create buttons
				array = {}
				var table = document.createElement('table');
				for (var i=0; i<size; i++){
					array[i] = {}
					var row = document.createElement('tr');
					for (var j=0; j<size; j++){
						var column = document.createElement('td');
						array[i][j] = column;
			            
						if( i!=0 || j!=0 ){	
							var newBtn = document.createElement('input');
				            newBtn.setAttribute("class", "btn btn-dark");
				            newBtn.setAttribute("value", size * i + j);
							newBtn.setAttribute("onclick", "btnClick(event)");
				            column.appendChild(newBtn);
						} else {
							empty_x = i;	empty_y = j;
							column.innerHTML = ''
						}
						row.appendChild(column);
					}
					table.appendChild(row);
				}
				field.appendChild(table);
				
				// shufle it
				for (var i=0; i<size; i++)
					for (var j=0; j<size; j++){
						swap( Math.floor(Math.random() * size) , Math.floor(Math.random() * size) , 
							Math.floor(Math.random() * size) , Math.floor(Math.random() * size) );
					}
			}
			function swap(old_x, old_y, new_x, new_y){
				var temp = array[old_x][old_y].firstChild;
				array[old_x][old_y].removeChild( array[old_x][old_y].firstChild ) ;
				array[old_x][old_y].appendChild( array[new_x][new_y].firstChild ) ;
				array[new_x][new_y].removeChild( array[new_x][new_y].firstChild ) ;
				array[new_x][new_y].appendChild( temp ) ;
			}
			function isVictory(){
				for (var i=0; i<size; i++)	for (var j=0; j<size; j++) 	
					if(array[i][j] != '') if(array[i][j].value != size * i + j + 1)	return false;
				return true;    
			}
			function updateTimer(){
			    var current = new Date();
			    time_diff = current.getTime() - time_start.getTime();
			    minutes_diff = Math.floor(time_diff / 1000 / 60);
			    seconds_diff = Math.floor(time_diff / 1000);
			    milliseconds_diff = time_diff - seconds_diff * 1000; 
			    seconds_diff = seconds_diff - minutes_diff * 60;
    			timer_label.innerHTML = minutes_diff + ":" + seconds_diff + ":" + milliseconds_diff;
			}
			function start(){
				time_start = new Date();
				timer_label.setAttribute("class", "badge badge-danger");
				timer = setInterval(updateTimer, 10); /*every 10 ms*/
				var btn = jQuery("#manage-time")[0];
				btn.setAttribute("onclick", "stop()");
				btn.setAttribute("value", "Stop");
			}
			function stop(){
				timer_label.setAttribute("class", "badge badge-success")
				clearInterval(timer);
				var btn = jQuery("#manage-time")[0];
				btn.setAttribute("onclick", "start()");
				btn.setAttribute("value", "Start");
			}
		</script>
</html>
