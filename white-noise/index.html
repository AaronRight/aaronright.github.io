<!DOCTYPE html>
<html lang="en">

<head>
  <title>React App</title>
  <style>
    html,
    body {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      flex: 1;
      flex-direction: row;
    }

    body {
      flex: 0.5;
      flex-direction: column;
      align-items: stretch;
    }

    #click {
      flex: 0.5;
      box-shadow: 5px 5px;
    }
  </style>
  <script>

    var play = true;

    var supportsES6 = function () {
      try {
        new Function("(a = 0) => a");
        return true;
      }
      catch (err) {
        return false;
      }
    }();

    // Web Audio API - White noise, generate, play (volume, fadeIn, fadeOut, loop), stop, fade - v1.0 MJF @ websemantics.uk
    //*
    var Noise = (function () {

      "use strict";
      if (!supportsES6) { return; }

      const audioContext = new (window.AudioContext || window.webkitAudioContext);

      let fadeOutTimer;

      // https://noisehack.com/generate-noise-web-audio-api/
      function createNoise(track) {

        const bufferSize = 2 * audioContext.sampleRate;
        const noiseBuffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
        const output = noiseBuffer.getChannelData(0);

        for (let i = 0; i < bufferSize; i++) {
          output[i] = Math.random() * 2 - 1;
        }

        track.audioSource.buffer = noiseBuffer;
      }

      function stopNoise(track) {
        if (track.audioSource) {
          clearTimeout(fadeOutTimer);
          track.audioSource.stop();
        }
      }

      function fadeNoise(track) {

        if (track.fadeOut) {
          track.fadeOut = (track.fadeOut >= 0) ? track.fadeOut : 0.5;
        } else {
          track.fadeOut = 0.5;
        }

        if (track.canFade) {
          track.gainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + track.fadeOut);
          track.canFade = false;

          fadeOutTimer = setTimeout(() => {
            stopNoise(track);
          }, track.fadeOut * 1000);

        } else {
          stopNoise(track);
        }
      }

      function buildTrack(track) {
        track.audioSource = audioContext.createBufferSource();
        track.gainNode = audioContext.createGain();
        track.audioSource.connect(track.gainNode);
        track.gainNode.connect(audioContext.destination);
        track.canFade = true; // used to prevent fadeOut firing twice
      }

      function setGain(track) {

        track.volume = (track.volume >= 0) ? track.volume : 0.5;

        if (track.fadeIn) {
          track.fadeIn = (track.fadeIn >= 0) ? track.fadeIn : 0.5;
        } else {
          track.fadeIn = 0.5;
        }

        track.gainNode.gain.setValueAtTime(0, audioContext.currentTime);

        track.gainNode.gain.linearRampToValueAtTime(track.volume / 4, audioContext.currentTime + track.fadeIn / 2);

        track.gainNode.gain.linearRampToValueAtTime(track.volume, audioContext.currentTime + track.fadeIn);

      }

      function playNoise(track) {
        stopNoise(track);
        buildTrack(track);
        createNoise(track);
        setGain(track);
        track.audioSource.loop = true;
        track.audioSource.start();
      }

      // Expose functions:
      return {
        play: playNoise,
        stop: stopNoise,
        fade: fadeNoise
      }
    }());

    var noise = {
      volume: 0.05, // 0 - 1
      fadeIn: 2.5, // time in seconds
      fadeOut: 1.3, // time in seconds
    }

  </script>
</head>

<body>
  <button id="click"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 10">
      <path fill="#000000" d="M 2,2 L 8,5 2,8 Z" />
    </svg>
  </button>

  <script>
    click.addEventListener('click', function (event) {
      if (play) {
        Noise.play(noise)
        event.currentTarget.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 10"> <rect fill="#000000" x="2" y="2" width="6" height="6" /> </svg>'
      } else {
        Noise.stop(noise)
        event.currentTarget.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 10"> <path fill="#000000" d="M 2,2 L 8,5 2,8 Z" /> </svg>'
      }
      play = !play;
    });
  </script>
</body>

</html>
